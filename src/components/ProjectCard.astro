---
interface Props {
  title: string;
  description: string;
  tags: string[];
  status: 'live' | 'beta' | 'coming-soon' | 'portfolio';
  slug: string;
  url?: string;
  repo?: string;
}

const { title, description, tags, status, slug, url, repo } = Astro.props;

const statusColors: Record<string, string> = {
  'live': 'bg-moss/20 text-moss',
  'beta': 'bg-amber/20 text-amber',
  'coming-soon': 'bg-indigo/20 text-indigo',
  'portfolio': 'bg-terracotta/20 text-terracotta',
};

const statusLabels: Record<string, string> = {
  'live': 'Live',
  'beta': 'Beta',
  'coming-soon': 'Initializing...',
  'portfolio': 'Research',
};

const hoverGlow: Record<string, string> = {
  'live': 'card-hover--moss',
  'beta': 'card-hover--amber',
  'coming-soon': 'card-hover--indigo',
  'portfolio': 'card-hover--terracotta',
};

const tagColors: Record<string, string> = {
  // Languages — moss
  'Python': 'border-moss/30 text-moss bg-moss/10',
  'R': 'border-moss/30 text-moss bg-moss/10',
  'Bash': 'border-moss/30 text-moss bg-moss/10',
  'Rust': 'border-moss/30 text-moss bg-moss/10',
  'Go': 'border-moss/30 text-moss bg-moss/10',
  'Bioinformatics': 'border-moss/30 text-moss bg-moss/10',
  'Genomics': 'border-moss/30 text-moss bg-moss/10',
  'nf-core': 'border-moss/30 text-moss bg-moss/10',
  // Cloud / infra — amber
  'AWS': 'border-amber/30 text-amber bg-amber/10',
  'AWS Batch': 'border-amber/30 text-amber bg-amber/10',
  'Nextflow': 'border-amber/30 text-amber bg-amber/10',
  'DRAGEN': 'border-amber/30 text-amber bg-amber/10',
  // Containers / web / tooling — indigo
  'Docker': 'border-indigo/30 text-indigo bg-indigo/10',
  'Singularity': 'border-indigo/30 text-indigo bg-indigo/10',
  'TypeScript': 'border-indigo/30 text-indigo bg-indigo/10',
  'FastAPI': 'border-indigo/30 text-indigo bg-indigo/10',
  'DNS': 'border-indigo/30 text-indigo bg-indigo/10',
  'Web Development': 'border-indigo/30 text-indigo bg-indigo/10',
  'Web': 'border-indigo/30 text-indigo bg-indigo/10',
  'Community': 'border-indigo/30 text-indigo bg-indigo/10',
  'Monitoring': 'border-indigo/30 text-indigo bg-indigo/10',
  'Analytics': 'border-indigo/30 text-indigo bg-indigo/10',
  // AI / ML — terracotta
  'PyTorch': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'TensorFlow': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'BERT': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'Transformers': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'NLP': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'Machine Learning': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'Computer Vision': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'Pose Estimation': 'border-terracotta/30 text-terracotta bg-terracotta/10',
  'DeepLabCut': 'border-terracotta/30 text-terracotta bg-terracotta/10',
};

const hasExternalLinks = url || repo;
---

<article class={`group relative border border-hairline rounded-sm bg-surface/50 hover:bg-surface card-hover ${hoverGlow[status]} animate-on-scroll flex flex-col`}>
  <!-- Card header with metadata -->
  <div class="px-5 pt-4 pb-3 border-b border-hairline flex items-center justify-between">
    <div class="flex items-center gap-3">
      <span class={`inline-flex items-center px-2 py-0.5 rounded-sm font-mono text-[10px] uppercase tracking-wider ${statusColors[status]}`}>
        {statusLabels[status]}
      </span>
    </div>
    <span class="font-mono text-[10px] text-text-faint">
      {tags[0]}
    </span>
  </div>

  <!-- Card body -->
  <div class="px-5 py-5 flex-1">
    <h3 class="font-serif text-xl font-semibold mb-2 group-hover:text-moss transition-colors" transition:name={`project-title-${slug}`}>
      <a href={`/projects/${slug}`} class="after:absolute after:inset-0">
        {title}
      </a>
    </h3>
    <p class="text-text-muted text-sm leading-relaxed line-clamp-3">
      {description}
    </p>
  </div>

  <!-- Card footer: action links + tags -->
  <div class="px-5 pb-4">
    <!-- Explicit action CTAs — z-10 to sit above the card's after:absolute overlay -->
    {hasExternalLinks && (
      <div class="relative z-10 flex items-center gap-4 mb-3 pt-2 border-t border-hairline">
        {url && (
          <a
            href={url}
            target="_blank"
            rel="noopener noreferrer"
            class="font-mono text-[11px] text-moss hover:text-moss/80 flex items-center gap-1 transition-colors"
          >
            Visit Site &#8599;
          </a>
        )}
        {repo && (
          <a
            href={repo}
            target="_blank"
            rel="noopener noreferrer"
            class="font-mono text-[11px] text-indigo hover:text-indigo/80 flex items-center gap-1 transition-colors"
          >
            GitHub &#8599;
          </a>
        )}
        <a
          href={`/projects/${slug}`}
          class="font-mono text-[11px] text-text-faint hover:text-text-muted flex items-center gap-1 ml-auto transition-colors relative z-10"
        >
          Case Study &rarr;
        </a>
      </div>
    )}

    <!-- Tags -->
    <div class="flex flex-wrap gap-2">
      {tags.map((tag) => (
        <span class={`font-mono text-[10px] px-1.5 py-0.5 border rounded-sm ${tagColors[tag] ?? 'border-hairline text-text-faint'}`}>
          {tag}
        </span>
      ))}
    </div>
  </div>
</article>
